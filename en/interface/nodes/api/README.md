# API Call logic

You can integrate with any API which supports formats:
*   JSON
*   XML
*   SOAP

![](../../img/create/api_call.png)

Nodes that are marked with grey square are added automatically to handle errors that occur when API is called.

## URL API

![](../../img/create/api_call_URL_API.png)


* **URL** - URL to retrieve data
* **Request format** - request format
    * `Corezoid` - request to API in [corezoid format](corezoid.md)
    * `Default` - gives possibility to select HTTP method of request to API

* **Request method** - [GET](get.md), [POST](post.md), [PUT, DELETE, HEAD, PATCH](put__delete__head.md)
* **Content-Type** - defines what data format is being transferred in API request:
    *   application/json
    *   application/x-www-form-urlencoded
    *   application/xml
    *   text/xml
    *   application/soap+xml


## Parameters

#### Key-Value

![](../../img/create/api_call_parameters.png)


**`Key`** (parameter name) = **`Value`** (parameter value)

**`+ Add "key-value"`** - button to add new key-value pair

`Value` may contain:
- constant
- `{{parameter_name}}` from task which value will be passed. If parameter contains array or parameter's name is specified incorrectly - empty value will be passed
-   `{{root.task_id}}` - task ID (generated by the system)
-   `{{root.ref}}` - task reference
-   `{{root.conv_id}}` - process ID
-   `{{root.node_id}}` - node ID
-   `{{root.prev_node_id}}` - previous node ID
-   `{{root.create_time}}` - task creation time in unixtime
-   `{{root.change_time}}` - time of task modifying in unixtime
-   `{{root.end_time}}` - dynamic time of timer work (for example, if you need timer to work at 8 AM)
-   `{{root.user_id}}` - user ID (who modified the task for the last time).


#### Code editor

![](../../img/create/api_call_parameters_code_editor.png)

Adding request parameters as JSON object (key-value pairs):

![](../../img/create/editor_code.png)


## Additionally

#### Header parameters

![](../../img/create/api_call_header.png)

Adding parameters to header of HTTP request in "key-value" format.

#### Customize the response parameters

Allows to get access to `header` and `body` parameters:

![](../../img/create/api_call_customize.png)

**Response format** - defines type of the reply from API:
*   Default
*   application/json
*   application/x-www-form-urlencoded
*   application/xml
*   text/xml
*   application/soap+xml

**`+ Add "key-value"`** - add other parameters from reply

#### Limit the number of simultaneous requests to the API

![](../../img/create/api_call_threads.png)

Maximum amount of the number of simultaneous requests to API.

By default = 5.


#### Send system parameters

Enable this flag if you want to add system parameters to request URL.

![](../../img/create/api_call_send_sys.png)

For example,

http://api.openweathermap.org/data/2.5/weather?q=london&units=metric&conv_signature={{conv_signature}}&conv_time={{conv_time}}&conv_id={{conv_id}}

`conv_signature` - key generated in the node with API logic. It is a unique value and is formed according to "[Protocol descroption](../../../api/v1/spec.md)" section.

`conv_time` - request time (unixtime) in seconds (epoch time), Greenwich (GMT+0), integer, required parameter.

`conv_id` - process ID.


#### Debug info

![](../../img/create/api_call_debug.png)

Enable this flag to add to the task a runtime of HTTP request to API in milliseconds. This value contains parameter `{{__conveyor_api_debug__.http_exec_time}}`.


#### Sign the request by secret key

![](../../img/create/api_call_sign_request.png)

Enable this flag if there is a key to sign the API request formed as [signature](../../../api/v1/spec.md).


#### Sign the request by certificate

![](../../img/create/api_call_srtificate.png)

Enable this flag to sign API request by certificate:
```
-----BEGIN RSA PRIVATE KEY-----
...
-----END RSA PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
....
-----END CERTIFICATE-----
```


#### Alert when there is tasks queue

The critical number of tasks in the node or the tasks limit.

[More details](../timer.md#tasks-limit) about how it works.

#### Limit the time of the task in the node

Time interval specified in the field **Limit the time of the task in the node**. After the time expires, the task goes to the specified node.

[More details](../timer.md#timer) about how it works.
