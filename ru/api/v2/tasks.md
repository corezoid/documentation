# Операции с заявками

*   [Создание заявки](#cоздание-заявки)
*   [Модификация заявки](#изменение-заявки)
*   [Просмотр заявки](#просмотр-заявки)
*   [Удаление заявки](#удаление-заявки)

## Создание заявки

**Запрос**

```json
{
  "ops": [
    {
      "type": "create",
      "conv_id": "{{process_id}}",
      "obj": "task",
      "data": {
        "test_id": "xxx"
      },
      "ref": "{{ref}}",
      "id": "{{id}}"
    }
  ]
}
```

| parameter | accept type | description | required | possible value |
| --- | --- | --- | --- | --- |
| `ops`| JSON Object | Параметр, в котором передаются JSON объекты с операциями | `+` | `* Количество операций ограничивается лимитами пользователя` |
| `type` | string | Тип для создания заявки | `+` | create |
| `conv_id` | number / number as string | Идентификатор процесса, для которого создается заявка | `+` | Идентификатор существующего процесса |
| `obj` | string | Тип объекта | `+` | task |
| `data` | JSON Object | Объект с парами ключ-значение, описывающими необходимые параметры | `+` | `** Нет ограничение на количество параметров**` |
| `ref` | string / number / null | `*** Внешний идентификатор заявки` | `-` | Могут использоваться любые символы, при этом длина ограничивается диапазоном от 1 до 255 символов, и параметр должен быть уникальным в рамках всех активных объектов данного типа |
| `id` | string / number | `*** Параметр для идентификации операции в массиве Ops` | `-` | Могут использоваться любые символы, длина ограничена размером HTTP запроса |

`* См. лицензионное соглашение`\
`** Заявка ограничивается только размером, который задается в конфигурационном файле`\
`*** Является обязательным для модификации заявки`\
`**** Параметр используется в любых запросах для идентификации операции в массиве **ops**`\

### Добавление одной заявки

Создание заявки с одним параметром (ключ "test_id", значение 123) в процессе с идентификатором - 12345 и референсом - 1559655803

**Запрос**

```json
{
  "ops": [
    {
      "type": "create",
      "conv_id": 12345,
      "obj": "task",
      "data": {
        "test_id": "123"
      },
      "ref": "1559655803"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655803",
      "obj_id": "5cf67011094bab1b9a00a31d"
    }
  ]
}
```

| parameter | description |
| --- | --- |
| `request_proc` | Общий статус обработки всех операций из запроса |
| `ops` | Параметр, в котором передаются JSON объекты с операциями |
| `id` | Идентификатор операции в массиве ops |
| `proc` | Статус обработки конкретной операции |
| `ref` | Внешний идентификатор заявки |
| `obj_id` | Идентификатор созданного объекта (заявки) |

### Добавление нескольких заявок

**Запрос**

```json
{
  "ops": [
    {
      "type": "create",
      "conv_id": 12345,
      "obj": "task",
      "data": {
        "test_id": "123"
      },
      "id": "1a"
    },
    {
      "type": "create",
      "conv_id": 12346,
      "obj": "task",
      "data": {
        "client_id": "00001"
      },
      "ref": "1559655804",
      "id": "2b"
    },
    {
      "type": "create",
      "conv_id": 12347,
      "obj": "task",
      "data": {
        "status": "IN"
      },
      "ref": "1559655805",
      "id": "3c"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "1a",
      "proc": "ok",
      "obj": "task",
      "ref": null,
      "obj_id": "5cf67011094bab1b9a00a31d"
    },
    {
      "id": "3c",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655805",
      "obj_id": "5cf66ae256167c6c7f00a26d"
    },
    {
      "id": "2b",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655804",
      "obj_id": "5cf66b9856167c6c7f00a278"
    }
  ]
}
```


## Изменение заявки

**Запрос**

```json
{
  "ops": [
    {
      "type": "modify",
      "conv_id": "{{process_id}}",
      "obj": "task",
      "data": {
        "test_id": "xxx"
      },
      "ref": "{{ref}}",
      "id": "{{id}}"
    }
  ]
}
```

| parameter | accept type | description | required | possible value |
| --- | --- | --- | --- | --- |
| `ops`| JSON Object | Параметр, в котором передаются JSON объекты с операциями | `+` | `* Количество операций ограничивается лимитами пользователя` |
| `type` | string | Тип для создания заявки | `+` | modify |
| `conv_id` | number / number as string | Идентификатор процесса, для которого создается заявка | `+` | Идентификатор существующего процесса |
| `obj` | string | Тип объекта | `+` | task |
| `data` | JSON Object | Объект с парами ключ-значение, описывающими необходимые параметры | `+` | `** Нет ограничение на количество параметров**` |
| `ref` | string / number / null | Внешний идентификатор заявки | `+` | Могут использоваться любые символы, при этом длина ограничивается диапазоном от 1 до 255 символов, и параметр должен быть уникальным в рамках всех активных объектов данного типа |
| `id` | string / number | `*** Параметр для идентификации операции в массиве ops` | `-` | Могут использоваться любые символы, длина ограничена размером HTTP запроса |

`* См. лицензионное соглашение`\
`** Заявка ограничивается только размером, который задается в конфигурационном файле`\
`*** Параметр используется в любых запросах для идентификации операции в массиве Ops`\

### Изменение одной заявки

Изменение заявки с одним параметром (модифицироваться может ключ "user_id" и значение 777) в процессе с идентификатором - 12345 и референсом - 1559655803

**Запрос**

```json
{
  "ops": [
    {
      "type": "modify",
      "conv_id": 12345,
      "obj": "task",
      "data": {
        "user_id": "777"
      },
      "ref": "1559655803"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655803",
      "obj_id": "5cf67011094bab1b9a00a31d"
    }
  ]
}
```

| parameter | description |
| --- | --- |
| `request_proc` | Общий статус обработки всех операций из запроса |
| `ops` | Параметр, в котором передаются JSON объекты с операциями |
| `id` | Идентификатор операции в массиве Ops |
| `proc` | Статус обработки конкретной операции |
| `ref` | Внешний идентификатор заявки |
| `obj_id` | Идентификатор созданного объекта (заявки) |

### Изменение нескольких заявок

**Запрос**

```json
{
  "ops": [
    {
      "type": "modify",
      "conv_id": 12345,
      "obj": "task",
      "data": {
        "test_id": "123"
      },
      "obj_id": "5cf67011094bab1b9a00a31d",
      "id": "1a"
    },
    {
      "type": "modify",
      "conv_id": 12346,
      "obj": "task",
      "data": {
        "client_id": "00001"
      },
      "ref": "1559655804",
      "id": "2b"
    },
    {
      "type": "modify",
      "conv_id": 12347,
      "obj": "task",
      "data": {
        "status": "IN"
      },
      "ref": "1559655805",
      "id": "3c"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "1a",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655803",
      "obj_id": "5cf67011094bab1b9a00a31d"
    },
    {
      "id": "3c",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655805",
      "obj_id": "5cf66ae256167c6c7f00a26d"
    },
    {
      "id": "2b",
      "proc": "ok",
      "obj": "task",
      "ref": "1559655804",
      "obj_id": "5cf66b9856167c6c7f00a278"
    }
  ]
}
```
`Модификация заявки может осуществляться по референсу ("ref") или идентификатору объекта ("obj_id")`

## Просмотр заявки

**Запрос**

```json
{
  "ops": [
    {
      "type": "show",
      "conv_id": "{{process_id}}",
      "obj": "task",
      "ref": "{{ref}}",
      "id": "{{id}}"
    },
    {
      "type": "show",
      "conv_id": "{{process_id}}",
      "obj": "task",
      "obj_id": "{{obj_id}}",
      "id": "{{id}}"
    }
  ]
}
```

| parameter | accept type | description | required | possible value |
| --- | --- | --- | --- | --- |
| `ops`| JSON Object | Параметр, в котором передаются JSON объекты с операциями | `+` | `* Количество операций ограничивается лимитами пользователя` |
| `type` | string | Тип для создания заявки | `+` | show |
| `conv_id` | number / number as string | Идентификатор процесса, для которого создается заявка | `+` | Идентификатор существующего процесса |
| `obj` | string | Тип объекта | `+` | task |
| `obj_id` | string | Идентификатор объекта (заявки) в системе | `+` | Идентификатор существующего объекта |
| `ref` | string / number / null | Внешний идентификатор заявки | `-` | Внешний идентификатор существующего объекта |
| `id` | string / number | `** Параметр для идентификации операции в массиве Ops` | `-` | Могут использоваться любые символы, длина ограничена размером HTTP запроса |

`* См. лицензионное соглашение`\
`** Параметр используется в любых запросах для идентификации операции в массиве Ops`\

> Просмотр заявки может выполняться отдельно по ее референсу или идентификатору

### Просмотр одной заявки

Просмотр заявки в процессе с идентификатором - 12345, референсом - 1559655803 и идентификатором объекта - 5cf7738c094bab29da000d5a

**Запрос**

```json
{
  "ops": [
    {
      "type": "show",
      "conv_id": 12345,
      "obj": "task",
      "ref": "1559655803",
      "id": "1"
    },
    {
      "type": "show",
      "conv_id": 12345,
      "obj": "task",
      "obj_id": "5cf7738c094bab29da000d5a",
      "id": "2"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "1",
      "proc": "ok",
      "obj": "task",
      "obj_id": "5cf7738c094bab29da000d5a",
      "ref": "1559655803",
      "status": "active",
      "user_id": 5555,
      "create_time": 1559722938,
      "change_time": 1559722943,
      "node_id": "5cf66f44094bab1b9a00a316",
      "node_prev_id": "5cf66f3d094bab1b9a00a314",
      "data": {
        "test_id": "***"
      }
    },
    {
      "id": "2",
      "proc": "ok",
      "obj": "task",
      "obj_id": "5cf7738c094bab29da000d5a",
      "ref": "1559655803",
      "status": "active",
      "user_id": 5555,
      "create_time": 1559722938,
      "change_time": 1559722943,
      "node_id": "5cf66f44094bab1b9a00a316",
      "node_prev_id": "5cf66f3d094bab1b9a00a314",
      "data": {
        "test_id": "***"
      }
    }
  ]
}
```

| parameter | description |
| --- | --- |
| `request_proc` | Общий статус обработки всех операций из запроса |
| `ops` | Параметр, в котором передаются JSON объекты с операциями |
| `id` | Идентификатор операции в массиве Ops |
| `proc` | Статус обработки конкретной операции |
| `obj` | Тип объекта - заявка |
| `obj_id` | Идентификатор объекта (заявки) |
| `ref` | Внешний идентификатор заявки |
| `status` | Текущий статус заявки |
| `user_id` | Идентификатор пользователя, который создал заявку |
| `create_time` | Время создания заявки в формате Unix Time|
| `change_time` | Время модификации заявки в формате Unix Time |
| `node_id` | Идентификатор узла, в котором находится заявка |
| `node_prev_id` | Идентификатор узла, из которого заявка была доставлена в текущий узел |
| `data` | Объект с парами ключ-значение, которые описывают пользовательские параметры |

[Типы параметров и управление параметрами](https://doc.corezoid.com/ru/interface/tasks/task_parameters.html)

## Удаление заявки

**Запрос**

```json
{
  "ops": [
    {
      "type": "delete",
      "conv_id": "{{process_id}}",
      "obj": "task",
      "obj_id": "{{obj_id}}",
      "node_id": "{{node_id}",
      "id": "{{id}}"
    }
  ]
}
```

| parameter | accept type | description | required | possible value |
| --- | --- | --- | --- | --- |
| `ops`| JSON Object | Параметр, в котором передаются JSON объекты с операциями | `+` | `* Количество операций ограничивается лимитами пользователя` |
| `type` | string | Тип для создания заявки | `+` | create |
| `conv_id` | number / number as string | Идентификатор процесса, для которого создается заявка | `+` | Идентификатор существующего процесса |
| `obj` | string | Тип объекта | `+` | task |
| `obj_id` | string | Идентификатор объекта (заявки) в системе | `+` | Идентификатор существующего объекта |
| `node_id` | string | Идентификатор узла в процессе, в котором находится заявка | `+` | Идентификатор существующего узла |
| `id` | string / number | `** Параметр для идентификации операции в массиве ops` | `-` | Могут использоваться любые символы, длина ограничена размером HTTP запроса |

`* См. лицензионное соглашение`\
`** Параметр используется в любых запросах для идентификации операции в массиве Ops`\

### Удаление одной заявки

Удаление заявки c идентификатором объекта - 5cf7c0bb094bab1d7a006c1e из узла с идентификатором - 5cf66f44094bab1b9a00a316 в процессе с идентификатором - 12345

**Запрос**

```json
{
  "ops": [
    {
      "type": "delete",
      "obj": "task",
      "conv_id": 12345,
      "node_id": "5cf66f44094bab1b9a00a316",
      "obj_id": "5cf7c0bb094bab1d7a006c1e"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "",
      "proc": "ok",
      "obj": "task",
      "obj_id": "5cf7c0bb094bab1d7a006c1e"
    }
  ]
}
```
`* Фактическое удаление заявки может выполняться от 100 до 500 мс `


| parameter | description |
| --- | --- |
| `request_proc` | Общий статус обработки всех операций из запроса |
| `ops` | Параметр, в котором передаются JSON объекты с операциями |
| `id` | Идентификатор операции в массиве Ops |
| `proc` | Статус обработки конкретной операции |
| `obj` | Тип объекта - заявка |
| `obj_id` | Идентификатор удаляемого объекта (заявки) |

### Удаление нескольких заявок

**Запрос**

```json
{
  "ops": [
    {
      "type": "delete",
      "obj": "task",
      "conv_id": 12345,
      "node_id": "5cf66f44094bab1b9a00a316",
      "obj_id": "5cf7c0bb094bab1d7a006c1e",
      "id": "1a"
    },
    {
      "type": "delete",
      "obj": "task",
      "conv_id": 12345,
      "node_id": "6cf66f44094bab1b9a00a316",
      "obj_id": "6cf7c0bb094bab1d7a006c1e",
      "id": "2b"
    },
    {
      "type": "delete",
      "obj": "task",
      "conv_id": 12345,
      "node_id": "7cf66f44094bab1b9a00a316",
      "obj_id": "7cf7c0bb094bab1d7a006c1e",
      "id": "3c"
    }
  ]
}
```

**Ответ**

```json
{
  "request_proc": "ok",
  "ops": [
    {
      "id": "1a",
      "proc": "ok",
      "obj": "task",
      "obj_id": "5cf7c0bb094bab1d7a006c1e"
    },
    {
      "id": "3c",
      "proc": "ok",
      "obj": "task",
      "obj_id": "7cf7c0bb094bab1d7a006c1e"
    },
    {
      "id": "2b",
      "proc": "ok",
      "obj": "task",
      "obj_id": "6cf7c0bb094bab1d7a006c1e"
    }
  ]
}
```
